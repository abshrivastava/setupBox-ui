'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _renderLoop = require('../framesync/render-loop');

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Render = function () {
  function Render(onChange, valueMap) {
    _classCallCheck(this, Render);

    this.values = _extends({}, valueMap);
    this.state = {};
    this.onChange = onChange;

    for (var key in valueMap) {
      this.register(valueMap[key]);
    }
  }

  Render.prototype.register = function register(value) {
    value.subscribe(this.invalidate);
  };

  Render.prototype.invalidate = function invalidate() {
    if (!this.hasChanged) {
      (0, _renderLoop.onFrameRender)(this.render);
    }

    this.hasChanged = true;
  };

  Render.prototype.render = function render() {
    this.hasChanged = false;
    this.onChange(this.values);
  };

  return Render;
}();

exports.default = function (output, valueMap) {
  return new Render(output, valueMap);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9yZW5kZXIvcmVuZGVyLmpzIl0sIm5hbWVzIjpbIlJlbmRlciIsIm9uQ2hhbmdlIiwidmFsdWVNYXAiLCJ2YWx1ZXMiLCJzdGF0ZSIsImtleSIsInJlZ2lzdGVyIiwidmFsdWUiLCJzdWJzY3JpYmUiLCJpbnZhbGlkYXRlIiwiaGFzQ2hhbmdlZCIsInJlbmRlciIsIm91dHB1dCJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7Ozs7SUFFTUEsTTtBQUNKLFdBRElBLE1BQ0osQ0FBWUMsUUFBWixFQUFzQkMsUUFBdEIsRUFBZ0M7QUFBQSwwQkFENUJGLE1BQzRCOztBQUM5QixTQUFLRyxNQUFMLGdCQUFrQkQsUUFBbEI7QUFDQSxTQUFLRSxLQUFMLEdBQWEsRUFBYjtBQUNBLFNBQUtILFFBQUwsR0FBZ0JBLFFBQWhCOztBQUVBLFNBQUssSUFBSUksR0FBVCxJQUFnQkgsUUFBaEIsRUFBMEI7QUFDeEIsV0FBS0ksUUFBTCxDQUFjSixTQUFTRyxHQUFULENBQWQ7QUFDRDtBQUNGOztBQVRHTCxRLFdBV0pNLFEscUJBQVNDLEssRUFBTztBQUNkQSxVQUFNQyxTQUFOLENBQWdCLEtBQUtDLFVBQXJCO0FBQ0QsRzs7QUFiR1QsUSxXQWVKUyxVLHlCQUFhO0FBQ1gsUUFBSSxDQUFDLEtBQUtDLFVBQVYsRUFBc0I7QUFDcEIscUNBQWMsS0FBS0MsTUFBbkI7QUFDRDs7QUFFRCxTQUFLRCxVQUFMLEdBQWtCLElBQWxCO0FBQ0QsRzs7QUFyQkdWLFEsV0F1QkpXLE0scUJBQVM7QUFDUCxTQUFLRCxVQUFMLEdBQWtCLEtBQWxCO0FBQ0EsU0FBS1QsUUFBTCxDQUFjLEtBQUtFLE1BQW5CO0FBQ0QsRzs7U0ExQkdILE07OztrQkE2QlMsVUFBQ1ksTUFBRCxFQUFTVixRQUFUO0FBQUEsU0FBc0IsSUFBSUYsTUFBSixDQUFXWSxNQUFYLEVBQW1CVixRQUFuQixDQUF0QjtBQUFBLEMiLCJmaWxlIjoicmVuZGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgb25GcmFtZVJlbmRlciB9IGZyb20gJy4uL2ZyYW1lc3luYy9yZW5kZXItbG9vcCc7XG5cbmNsYXNzIFJlbmRlciB7XG4gIGNvbnN0cnVjdG9yKG9uQ2hhbmdlLCB2YWx1ZU1hcCkge1xuICAgIHRoaXMudmFsdWVzID0gey4uLnZhbHVlTWFwfTtcbiAgICB0aGlzLnN0YXRlID0ge307XG4gICAgdGhpcy5vbkNoYW5nZSA9IG9uQ2hhbmdlO1xuXG4gICAgZm9yIChsZXQga2V5IGluIHZhbHVlTWFwKSB7XG4gICAgICB0aGlzLnJlZ2lzdGVyKHZhbHVlTWFwW2tleV0pO1xuICAgIH1cbiAgfVxuXG4gIHJlZ2lzdGVyKHZhbHVlKSB7XG4gICAgdmFsdWUuc3Vic2NyaWJlKHRoaXMuaW52YWxpZGF0ZSk7XG4gIH1cblxuICBpbnZhbGlkYXRlKCkge1xuICAgIGlmICghdGhpcy5oYXNDaGFuZ2VkKSB7XG4gICAgICBvbkZyYW1lUmVuZGVyKHRoaXMucmVuZGVyKTtcbiAgICB9XG5cbiAgICB0aGlzLmhhc0NoYW5nZWQgPSB0cnVlO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIHRoaXMuaGFzQ2hhbmdlZCA9IGZhbHNlO1xuICAgIHRoaXMub25DaGFuZ2UodGhpcy52YWx1ZXMpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IChvdXRwdXQsIHZhbHVlTWFwKSA9PiBuZXcgUmVuZGVyKG91dHB1dCwgdmFsdWVNYXApO1xuXG5cbiJdfQ==