'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _renderLoop = require('../framesync/render-loop');

var _calc = require('../inc/calc');

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Action = function () {
  function Action(props) {
    _classCallCheck(this, Action);

    this.props = _extends({}, props);
    this.current = 0;
    this.velocity = 0;
    this.update = this.update.bind(this);
  }

  Action.prototype.addChild = function addChild(action) {
    this.children.push(action);
  };

  Action.prototype.start = function start() {
    (0, _renderLoop.onFrameUpdate)(this.update);

    if (this.props.from === undefined && this.props.value) {
      this.props.from = this.props.value.getCurrent();
    }

    if (this.onStart) {
      fireOnStart(this);
    }

    return this;
  };

  Action.prototype.stop = function stop() {
    (0, _renderLoop.cancelOnFrameUpdate)(this.update);

    if (this.onStart) {
      fireOnStop(this);
    }

    return this;
  };

  Action.prototype.complete = function complete() {
    if (this.onComplete) {
      this.onComplete(this);
    }

    return this;
  };

  Action.prototype.update = function update(framestamp, elapsed) {
    var current = this.getCurrent();
    var velocity = this.getVelocity();

    if (this.onUpdate) {
      this.current = this.onUpdate(framestamp, elapsed);
      this.velocity = (0, _calc.speedPerSecond)(this.current - current, elapsed);

      if (this.velocity) {
        // tell renderer to render
      }
    }

    // Check if action is complete, if not, fire on the next frame
    if (this.isActionComplete && this.isActionComplete()) {
      this.complete();
    } else {
      (0, _renderLoop.onFrameUpdate)(this.update);
    }

    this.lastUpdated = framestamp;
  };

  Action.prototype.set = function set(props) {
    this.props = _extends({}, this.props, props);
    return this;
  };

  Action.prototype.get = function get(key) {
    return this.props[key];
  };

  Action.prototype.getCurrent = function getCurrent() {
    return this.current;
  };

  Action.prototype.getVelocity = function getVelocity() {
    return this.velocity;
  };

  return Action;
}();

;

exports.default = Action;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zaW1wbGUtYWN0aW9ucy9BY3Rpb24uanMiXSwibmFtZXMiOlsiQWN0aW9uIiwicHJvcHMiLCJjdXJyZW50IiwidmVsb2NpdHkiLCJ1cGRhdGUiLCJiaW5kIiwiYWRkQ2hpbGQiLCJhY3Rpb24iLCJjaGlsZHJlbiIsInB1c2giLCJzdGFydCIsImZyb20iLCJ1bmRlZmluZWQiLCJ2YWx1ZSIsImdldEN1cnJlbnQiLCJvblN0YXJ0IiwiZmlyZU9uU3RhcnQiLCJzdG9wIiwiZmlyZU9uU3RvcCIsImNvbXBsZXRlIiwib25Db21wbGV0ZSIsImZyYW1lc3RhbXAiLCJlbGFwc2VkIiwiZ2V0VmVsb2NpdHkiLCJvblVwZGF0ZSIsImlzQWN0aW9uQ29tcGxldGUiLCJsYXN0VXBkYXRlZCIsInNldCIsImdldCIsImtleSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7O0FBQ0E7Ozs7SUFFTUEsTTtBQUNKLFdBRElBLE1BQ0osQ0FBWUMsS0FBWixFQUFtQjtBQUFBLDBCQURmRCxNQUNlOztBQUNqQixTQUFLQyxLQUFMLGdCQUFrQkEsS0FBbEI7QUFDQSxTQUFLQyxPQUFMLEdBQWUsQ0FBZjtBQUNBLFNBQUtDLFFBQUwsR0FBZ0IsQ0FBaEI7QUFDQSxTQUFLQyxNQUFMLEdBQWMsS0FBS0EsTUFBTCxDQUFZQyxJQUFaLENBQWlCLElBQWpCLENBQWQ7QUFDRDs7QUFOR0wsUSxXQVFKTSxRLHFCQUFTQyxNLEVBQVE7QUFDZixTQUFLQyxRQUFMLENBQWNDLElBQWQsQ0FBbUJGLE1BQW5CO0FBQ0QsRzs7QUFWR1AsUSxXQVlKVSxLLG9CQUFRO0FBQ04sbUNBQWMsS0FBS04sTUFBbkI7O0FBRUEsUUFBSSxLQUFLSCxLQUFMLENBQVdVLElBQVgsS0FBb0JDLFNBQXBCLElBQWlDLEtBQUtYLEtBQUwsQ0FBV1ksS0FBaEQsRUFBdUQ7QUFDckQsV0FBS1osS0FBTCxDQUFXVSxJQUFYLEdBQWtCLEtBQUtWLEtBQUwsQ0FBV1ksS0FBWCxDQUFpQkMsVUFBakIsRUFBbEI7QUFDRDs7QUFFRCxRQUFJLEtBQUtDLE9BQVQsRUFBa0I7QUFDaEJDLGtCQUFZLElBQVo7QUFDRDs7QUFFRCxXQUFPLElBQVA7QUFDRCxHOztBQXhCR2hCLFEsV0EwQkppQixJLG1CQUFPO0FBQ0wseUNBQW9CLEtBQUtiLE1BQXpCOztBQUVBLFFBQUksS0FBS1csT0FBVCxFQUFrQjtBQUNoQkcsaUJBQVcsSUFBWDtBQUNEOztBQUVELFdBQU8sSUFBUDtBQUNELEc7O0FBbENHbEIsUSxXQW9DSm1CLFEsdUJBQVc7QUFDVCxRQUFJLEtBQUtDLFVBQVQsRUFBcUI7QUFDbkIsV0FBS0EsVUFBTCxDQUFnQixJQUFoQjtBQUNEOztBQUVELFdBQU8sSUFBUDtBQUNELEc7O0FBMUNHcEIsUSxXQTRDSkksTSxtQkFBT2lCLFUsRUFBWUMsTyxFQUFTO0FBQzFCLFFBQU1wQixVQUFVLEtBQUtZLFVBQUwsRUFBaEI7QUFDQSxRQUFNWCxXQUFXLEtBQUtvQixXQUFMLEVBQWpCOztBQUVBLFFBQUksS0FBS0MsUUFBVCxFQUFtQjtBQUNqQixXQUFLdEIsT0FBTCxHQUFlLEtBQUtzQixRQUFMLENBQWNILFVBQWQsRUFBMEJDLE9BQTFCLENBQWY7QUFDQSxXQUFLbkIsUUFBTCxHQUFnQiwwQkFBZSxLQUFLRCxPQUFMLEdBQWVBLE9BQTlCLEVBQXVDb0IsT0FBdkMsQ0FBaEI7O0FBRUEsVUFBSSxLQUFLbkIsUUFBVCxFQUFtQjtBQUNqQjtBQUNEO0FBQ0Y7O0FBSUQ7QUFDQSxRQUFJLEtBQUtzQixnQkFBTCxJQUF5QixLQUFLQSxnQkFBTCxFQUE3QixFQUFzRDtBQUNwRCxXQUFLTixRQUFMO0FBQ0QsS0FGRCxNQUVPO0FBQ0wscUNBQWMsS0FBS2YsTUFBbkI7QUFDRDs7QUFFRCxTQUFLc0IsV0FBTCxHQUFtQkwsVUFBbkI7QUFDRCxHOztBQW5FR3JCLFEsV0FxRUoyQixHLGdCQUFJMUIsSyxFQUFPO0FBQ1QsU0FBS0EsS0FBTCxnQkFBa0IsS0FBS0EsS0FBdkIsRUFBaUNBLEtBQWpDO0FBQ0EsV0FBTyxJQUFQO0FBQ0QsRzs7QUF4RUdELFEsV0EwRUo0QixHLGdCQUFJQyxHLEVBQUs7QUFDUCxXQUFPLEtBQUs1QixLQUFMLENBQVc0QixHQUFYLENBQVA7QUFDRCxHOztBQTVFRzdCLFEsV0E4RUpjLFUseUJBQWE7QUFDWCxXQUFPLEtBQUtaLE9BQVo7QUFDRCxHOztBQWhGR0YsUSxXQWtGSnVCLFcsMEJBQWM7QUFDWixXQUFPLEtBQUtwQixRQUFaO0FBQ0QsRzs7U0FwRkdILE07OztBQXFGTDs7a0JBRWNBLE0iLCJmaWxlIjoiQWN0aW9uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgb25GcmFtZVVwZGF0ZSwgY2FuY2VsT25GcmFtZVVwZGF0ZSwgdGltZVNpbmNlTGFzdEZyYW1lIH0gZnJvbSAnLi4vZnJhbWVzeW5jL3JlbmRlci1sb29wJztcbmltcG9ydCB7IHNwZWVkUGVyU2Vjb25kIH0gZnJvbSAnLi4vaW5jL2NhbGMnO1xuXG5jbGFzcyBBY3Rpb24ge1xuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHRoaXMucHJvcHMgPSB7IC4uLnByb3BzIH07XG4gICAgdGhpcy5jdXJyZW50ID0gMDtcbiAgICB0aGlzLnZlbG9jaXR5ID0gMDtcbiAgICB0aGlzLnVwZGF0ZSA9IHRoaXMudXBkYXRlLmJpbmQodGhpcyk7XG4gIH1cblxuICBhZGRDaGlsZChhY3Rpb24pIHtcbiAgICB0aGlzLmNoaWxkcmVuLnB1c2goYWN0aW9uKTtcbiAgfVxuXG4gIHN0YXJ0KCkge1xuICAgIG9uRnJhbWVVcGRhdGUodGhpcy51cGRhdGUpO1xuXG4gICAgaWYgKHRoaXMucHJvcHMuZnJvbSA9PT0gdW5kZWZpbmVkICYmIHRoaXMucHJvcHMudmFsdWUpIHtcbiAgICAgIHRoaXMucHJvcHMuZnJvbSA9IHRoaXMucHJvcHMudmFsdWUuZ2V0Q3VycmVudCgpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLm9uU3RhcnQpIHtcbiAgICAgIGZpcmVPblN0YXJ0KHRoaXMpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgc3RvcCgpIHtcbiAgICBjYW5jZWxPbkZyYW1lVXBkYXRlKHRoaXMudXBkYXRlKTtcblxuICAgIGlmICh0aGlzLm9uU3RhcnQpIHtcbiAgICAgIGZpcmVPblN0b3AodGhpcyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBjb21wbGV0ZSgpIHtcbiAgICBpZiAodGhpcy5vbkNvbXBsZXRlKSB7XG4gICAgICB0aGlzLm9uQ29tcGxldGUodGhpcyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICB1cGRhdGUoZnJhbWVzdGFtcCwgZWxhcHNlZCkge1xuICAgIGNvbnN0IGN1cnJlbnQgPSB0aGlzLmdldEN1cnJlbnQoKTtcbiAgICBjb25zdCB2ZWxvY2l0eSA9IHRoaXMuZ2V0VmVsb2NpdHkoKTtcblxuICAgIGlmICh0aGlzLm9uVXBkYXRlKSB7XG4gICAgICB0aGlzLmN1cnJlbnQgPSB0aGlzLm9uVXBkYXRlKGZyYW1lc3RhbXAsIGVsYXBzZWQpO1xuICAgICAgdGhpcy52ZWxvY2l0eSA9IHNwZWVkUGVyU2Vjb25kKHRoaXMuY3VycmVudCAtIGN1cnJlbnQsIGVsYXBzZWQpO1xuXG4gICAgICBpZiAodGhpcy52ZWxvY2l0eSkge1xuICAgICAgICAvLyB0ZWxsIHJlbmRlcmVyIHRvIHJlbmRlclxuICAgICAgfVxuICAgIH1cblxuXG5cbiAgICAvLyBDaGVjayBpZiBhY3Rpb24gaXMgY29tcGxldGUsIGlmIG5vdCwgZmlyZSBvbiB0aGUgbmV4dCBmcmFtZVxuICAgIGlmICh0aGlzLmlzQWN0aW9uQ29tcGxldGUgJiYgdGhpcy5pc0FjdGlvbkNvbXBsZXRlKCkpIHtcbiAgICAgIHRoaXMuY29tcGxldGUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgb25GcmFtZVVwZGF0ZSh0aGlzLnVwZGF0ZSk7XG4gICAgfVxuXG4gICAgdGhpcy5sYXN0VXBkYXRlZCA9IGZyYW1lc3RhbXA7XG4gIH1cblxuICBzZXQocHJvcHMpIHtcbiAgICB0aGlzLnByb3BzID0geyAuLi50aGlzLnByb3BzLCAuLi5wcm9wcyB9O1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgZ2V0KGtleSkge1xuICAgIHJldHVybiB0aGlzLnByb3BzW2tleV07XG4gIH1cblxuICBnZXRDdXJyZW50KCkge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnQ7XG4gIH1cblxuICBnZXRWZWxvY2l0eSgpIHtcbiAgICByZXR1cm4gdGhpcy52ZWxvY2l0eTtcbiAgfVxufTtcblxuZXhwb3J0IGRlZmF1bHQgQWN0aW9uO1xuIl19