'use strict';

exports.__esModule = true;

var _ = require('./');

var _2 = _interopRequireDefault(_);

var _utils = require('../inc/utils');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var getChildCurrent = function (child) {
  return child.get();
};
var getChildVelocity = function (child) {
  return child.getVelocity();
};
var stopChild = function (child) {
  return child.stop();
};

var CompositeValue = function (_Value) {
  _inherits(CompositeValue, _Value);

  function CompositeValue(values, types) {
    _classCallCheck(this, CompositeValue);

    var _this = _possibleConstructorReturn(this, _Value.call(this));

    _this.types = types;
    _this.current = {};
    _this.velocity = {};
    _this.children = [];
    _this.update(values);
    return _this;
  }

  CompositeValue.prototype.update = function update(values) {
    for (var key in values) {
      var value = values[key];

      if (!this.hasOwnProperty(key)) {
        this.createChild(key, value);
      } else {
        this[key].update(values[key]);
      }

      this.current[key] = this[key].get();
    }

    this.__fireListeners();
  };

  CompositeValue.prototype.createChild = function createChild(key, value) {
    if ((0, _utils.isNum)(value)) {
      var type = this.types[key];
      this[key] = (0, _2.default)(value, type);
    } else if ((0, _utils.isString)(value)) {
      // Auto detect type?
    } else {
      this[key] = value;
    }

    this.children.push(key);
  };

  CompositeValue.prototype.eachChild = function eachChild(func) {
    var acc = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];

    var numChildren = this.children.length;
    for (var i = 0; i < numChildren; i++) {
      var childKey = this.children[i];
      acc[childKey] = func(this[childKey]);
    }
    return acc;
  };

  CompositeValue.prototype.get = function get() {
    return this.eachChild(getChildCurrent, this.current);
  };

  CompositeValue.prototype.getVelocity = function getVelocity() {
    return this.eachChild(getChildVelocity, this.velocity);
  };

  CompositeValue.prototype.stop = function stop() {
    this.eachChild(stopChild);
    return this;
  };

  return CompositeValue;
}(_.Value);

exports.default = function (values, types) {
  return new CompositeValue(values, types);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy92YWx1ZS9jb21wb3NpdGUtdmFsdWUuanMiXSwibmFtZXMiOlsiZ2V0Q2hpbGRDdXJyZW50IiwiY2hpbGQiLCJnZXQiLCJnZXRDaGlsZFZlbG9jaXR5IiwiZ2V0VmVsb2NpdHkiLCJzdG9wQ2hpbGQiLCJzdG9wIiwiQ29tcG9zaXRlVmFsdWUiLCJ2YWx1ZXMiLCJ0eXBlcyIsImN1cnJlbnQiLCJ2ZWxvY2l0eSIsImNoaWxkcmVuIiwidXBkYXRlIiwia2V5IiwidmFsdWUiLCJoYXNPd25Qcm9wZXJ0eSIsImNyZWF0ZUNoaWxkIiwiX19maXJlTGlzdGVuZXJzIiwidHlwZSIsInB1c2giLCJlYWNoQ2hpbGQiLCJmdW5jIiwiYWNjIiwibnVtQ2hpbGRyZW4iLCJsZW5ndGgiLCJpIiwiY2hpbGRLZXkiXSwibWFwcGluZ3MiOiI7Ozs7QUFBQTs7OztBQUNBOzs7Ozs7Ozs7O0FBRUEsSUFBTUEsa0JBQWtCLFVBQUNDLEtBQUQ7QUFBQSxTQUFXQSxNQUFNQyxHQUFOLEVBQVg7QUFBQSxDQUF4QjtBQUNBLElBQU1DLG1CQUFtQixVQUFDRixLQUFEO0FBQUEsU0FBV0EsTUFBTUcsV0FBTixFQUFYO0FBQUEsQ0FBekI7QUFDQSxJQUFNQyxZQUFZLFVBQUNKLEtBQUQ7QUFBQSxTQUFXQSxNQUFNSyxJQUFOLEVBQVg7QUFBQSxDQUFsQjs7SUFFTUMsYztZQUFBQSxjOztBQUNKLFdBRElBLGNBQ0osQ0FBWUMsTUFBWixFQUFvQkMsS0FBcEIsRUFBMkI7QUFBQSwwQkFEdkJGLGNBQ3VCOztBQUFBLGlEQUN6QixpQkFEeUI7O0FBRXpCLFVBQUtFLEtBQUwsR0FBYUEsS0FBYjtBQUNBLFVBQUtDLE9BQUwsR0FBZSxFQUFmO0FBQ0EsVUFBS0MsUUFBTCxHQUFnQixFQUFoQjtBQUNBLFVBQUtDLFFBQUwsR0FBZ0IsRUFBaEI7QUFDQSxVQUFLQyxNQUFMLENBQVlMLE1BQVo7QUFOeUI7QUFPMUI7O0FBUkdELGdCLFdBVUpNLE0sbUJBQU9MLE0sRUFBUTtBQUNiLFNBQUssSUFBSU0sR0FBVCxJQUFnQk4sTUFBaEIsRUFBd0I7QUFDdEIsVUFBTU8sUUFBUVAsT0FBT00sR0FBUCxDQUFkOztBQUVBLFVBQUksQ0FBQyxLQUFLRSxjQUFMLENBQW9CRixHQUFwQixDQUFMLEVBQStCO0FBQzdCLGFBQUtHLFdBQUwsQ0FBaUJILEdBQWpCLEVBQXNCQyxLQUF0QjtBQUNELE9BRkQsTUFFTztBQUNMLGFBQUtELEdBQUwsRUFBVUQsTUFBVixDQUFpQkwsT0FBT00sR0FBUCxDQUFqQjtBQUNEOztBQUVELFdBQUtKLE9BQUwsQ0FBYUksR0FBYixJQUFvQixLQUFLQSxHQUFMLEVBQVVaLEdBQVYsRUFBcEI7QUFDRDs7QUFFRCxTQUFLZ0IsZUFBTDtBQUNELEc7O0FBeEJHWCxnQixXQTBCSlUsVyx3QkFBWUgsRyxFQUFLQyxLLEVBQU87QUFDdEIsUUFBSSxrQkFBTUEsS0FBTixDQUFKLEVBQWtCO0FBQ2hCLFVBQU1JLE9BQU8sS0FBS1YsS0FBTCxDQUFXSyxHQUFYLENBQWI7QUFDQSxXQUFLQSxHQUFMLElBQVksZ0JBQVlDLEtBQVosRUFBbUJJLElBQW5CLENBQVo7QUFDRCxLQUhELE1BR08sSUFBSSxxQkFBU0osS0FBVCxDQUFKLEVBQXFCO0FBQzFCO0FBQ0QsS0FGTSxNQUVBO0FBQ0wsV0FBS0QsR0FBTCxJQUFZQyxLQUFaO0FBQ0Q7O0FBRUQsU0FBS0gsUUFBTCxDQUFjUSxJQUFkLENBQW1CTixHQUFuQjtBQUNELEc7O0FBckNHUCxnQixXQXVDSmMsUyxzQkFBVUMsSSxFQUFnQjtBQUFBLFFBQVZDLEdBQVUseURBQUosRUFBSTs7QUFDeEIsUUFBTUMsY0FBYyxLQUFLWixRQUFMLENBQWNhLE1BQWxDO0FBQ0EsU0FBSyxJQUFJQyxJQUFJLENBQWIsRUFBZ0JBLElBQUlGLFdBQXBCLEVBQWlDRSxHQUFqQyxFQUFzQztBQUNwQyxVQUFNQyxXQUFXLEtBQUtmLFFBQUwsQ0FBY2MsQ0FBZCxDQUFqQjtBQUNBSCxVQUFJSSxRQUFKLElBQWdCTCxLQUFLLEtBQUtLLFFBQUwsQ0FBTCxDQUFoQjtBQUNEO0FBQ0QsV0FBT0osR0FBUDtBQUNELEc7O0FBOUNHaEIsZ0IsV0FnREpMLEcsa0JBQU07QUFDSixXQUFPLEtBQUttQixTQUFMLENBQWVyQixlQUFmLEVBQWdDLEtBQUtVLE9BQXJDLENBQVA7QUFDRCxHOztBQWxER0gsZ0IsV0FvREpILFcsMEJBQWM7QUFDWixXQUFPLEtBQUtpQixTQUFMLENBQWVsQixnQkFBZixFQUFpQyxLQUFLUSxRQUF0QyxDQUFQO0FBQ0QsRzs7QUF0REdKLGdCLFdBd0RKRCxJLG1CQUFPO0FBQ0wsU0FBS2UsU0FBTCxDQUFlaEIsU0FBZjtBQUNBLFdBQU8sSUFBUDtBQUNELEc7O1NBM0RHRSxjOzs7a0JBOERTLFVBQUNDLE1BQUQsRUFBU0MsS0FBVDtBQUFBLFNBQW1CLElBQUlGLGNBQUosQ0FBbUJDLE1BQW5CLEVBQTJCQyxLQUEzQixDQUFuQjtBQUFBLEMiLCJmaWxlIjoiY29tcG9zaXRlLXZhbHVlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNyZWF0ZVZhbHVlLCB7IFZhbHVlIH0gZnJvbSAnLi8nO1xuaW1wb3J0IHsgaXNOdW0sIGlzU3RyaW5nIH0gZnJvbSAnLi4vaW5jL3V0aWxzJztcblxuY29uc3QgZ2V0Q2hpbGRDdXJyZW50ID0gKGNoaWxkKSA9PiBjaGlsZC5nZXQoKTtcbmNvbnN0IGdldENoaWxkVmVsb2NpdHkgPSAoY2hpbGQpID0+IGNoaWxkLmdldFZlbG9jaXR5KCk7XG5jb25zdCBzdG9wQ2hpbGQgPSAoY2hpbGQpID0+IGNoaWxkLnN0b3AoKTtcblxuY2xhc3MgQ29tcG9zaXRlVmFsdWUgZXh0ZW5kcyBWYWx1ZSB7XG4gIGNvbnN0cnVjdG9yKHZhbHVlcywgdHlwZXMpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMudHlwZXMgPSB0eXBlcztcbiAgICB0aGlzLmN1cnJlbnQgPSB7fTtcbiAgICB0aGlzLnZlbG9jaXR5ID0ge307XG4gICAgdGhpcy5jaGlsZHJlbiA9IFtdO1xuICAgIHRoaXMudXBkYXRlKHZhbHVlcyk7XG4gIH1cblxuICB1cGRhdGUodmFsdWVzKSB7XG4gICAgZm9yIChsZXQga2V5IGluIHZhbHVlcykge1xuICAgICAgY29uc3QgdmFsdWUgPSB2YWx1ZXNba2V5XTtcblxuICAgICAgaWYgKCF0aGlzLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgdGhpcy5jcmVhdGVDaGlsZChrZXksIHZhbHVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXNba2V5XS51cGRhdGUodmFsdWVzW2tleV0pO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmN1cnJlbnRba2V5XSA9IHRoaXNba2V5XS5nZXQoKTtcbiAgICB9XG5cbiAgICB0aGlzLl9fZmlyZUxpc3RlbmVycygpO1xuICB9XG5cbiAgY3JlYXRlQ2hpbGQoa2V5LCB2YWx1ZSkge1xuICAgIGlmIChpc051bSh2YWx1ZSkpIHtcbiAgICAgIGNvbnN0IHR5cGUgPSB0aGlzLnR5cGVzW2tleV07XG4gICAgICB0aGlzW2tleV0gPSBjcmVhdGVWYWx1ZSh2YWx1ZSwgdHlwZSk7XG4gICAgfSBlbHNlIGlmIChpc1N0cmluZyh2YWx1ZSkpIHtcbiAgICAgIC8vIEF1dG8gZGV0ZWN0IHR5cGU/XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXNba2V5XSA9IHZhbHVlO1xuICAgIH1cblxuICAgIHRoaXMuY2hpbGRyZW4ucHVzaChrZXkpO1xuICB9XG5cbiAgZWFjaENoaWxkKGZ1bmMsIGFjYyA9IHt9KSB7XG4gICAgY29uc3QgbnVtQ2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuLmxlbmd0aDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUNoaWxkcmVuOyBpKyspIHtcbiAgICAgIGNvbnN0IGNoaWxkS2V5ID0gdGhpcy5jaGlsZHJlbltpXTtcbiAgICAgIGFjY1tjaGlsZEtleV0gPSBmdW5jKHRoaXNbY2hpbGRLZXldKTtcbiAgICB9XG4gICAgcmV0dXJuIGFjYztcbiAgfVxuXG4gIGdldCgpIHtcbiAgICByZXR1cm4gdGhpcy5lYWNoQ2hpbGQoZ2V0Q2hpbGRDdXJyZW50LCB0aGlzLmN1cnJlbnQpO1xuICB9XG5cbiAgZ2V0VmVsb2NpdHkoKSB7XG4gICAgcmV0dXJuIHRoaXMuZWFjaENoaWxkKGdldENoaWxkVmVsb2NpdHksIHRoaXMudmVsb2NpdHkpO1xuICB9XG5cbiAgc3RvcCgpIHtcbiAgICB0aGlzLmVhY2hDaGlsZChzdG9wQ2hpbGQpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0ICh2YWx1ZXMsIHR5cGVzKSA9PiBuZXcgQ29tcG9zaXRlVmFsdWUodmFsdWVzLCB0eXBlcyk7XG4iXX0=