'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _loop = require('./loop');

var loop = _interopRequireWildcard(_loop);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _objectWithoutProperties(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } } /*
                                                                                                                                                            Base Task class for creating a task on the main render loop.
                                                                                                                                                          */


function cleanup() {
  this.onCleanup = undefined;
  loop.deactivate(this.id);
}

function activate() {
  this.onCleanup = cleanup;
}

var Task = function () {
  function Task(props) {
    _classCallCheck(this, Task);

    this.id = loop.getTaskId();
    this.isActive = false;

    if (this.defaultProps) {
      for (var key in this.defaultProps) {
        if (this.defaultProps.hasOwnProperty(key)) {
          this[key] = this.defaultProps[key];
        }
      }
    }

    this.set(props);
  }

  Task.prototype.set = function set(props) {
    for (var key in props) {
      if (props.hasOwnProperty(key)) {
        this[key] = props[key];
      }
    }

    return this;
  };

  Task.prototype.start = function start() {
    loop.activate(this.id, this);

    this.onActivateLoop = this.onCleanup = undefined;
    this.isComplete = false;

    if (this.onStart) {
      this.onStart(this);
    }

    return this;
  };

  Task.prototype.stop = function stop() {
    loop.deactivate(this.id);

    if (this.onStop) {
      this.onStop(this);
    }

    return this;
  };

  Task.prototype.once = function once() {
    loop.activate(this.id, this);
    this.onCleanup = undefined;
    this.onActivateLoop = activate;

    return this;
  };

  Task.prototype.complete = function complete() {
    this.stop();

    if (this.onComplete) {
      this.onComplete(this);
    }
  };

  /*
    # Extend this Process with new properties
    ## Returns new instance of this Process's `prototype` with existing and new properties
     @param [object] (optional)
    @return [Process]
  */


  Task.prototype.inherit = function inherit(props) {
    var id = this.id;

    var inheritedProps = _objectWithoutProperties(this, ['id']);

    return new this.constructor(_extends({}, inheritedProps, props));
  };

  return Task;
}();

exports.default = Task;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90YXNrL1Rhc2suanMiXSwibmFtZXMiOlsibG9vcCIsImNsZWFudXAiLCJvbkNsZWFudXAiLCJ1bmRlZmluZWQiLCJkZWFjdGl2YXRlIiwiaWQiLCJhY3RpdmF0ZSIsIlRhc2siLCJwcm9wcyIsImdldFRhc2tJZCIsImlzQWN0aXZlIiwiZGVmYXVsdFByb3BzIiwia2V5IiwiaGFzT3duUHJvcGVydHkiLCJzZXQiLCJzdGFydCIsIm9uQWN0aXZhdGVMb29wIiwiaXNDb21wbGV0ZSIsIm9uU3RhcnQiLCJzdG9wIiwib25TdG9wIiwib25jZSIsImNvbXBsZXRlIiwib25Db21wbGV0ZSIsImluaGVyaXQiLCJpbmhlcml0ZWRQcm9wcyIsImNvbnN0cnVjdG9yIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFHQTs7SUFBWUEsSTs7Ozs7OzBKQUhaOzs7OztBQUtBLFNBQVNDLE9BQVQsR0FBbUI7QUFDakIsT0FBS0MsU0FBTCxHQUFpQkMsU0FBakI7QUFDQUgsT0FBS0ksVUFBTCxDQUFnQixLQUFLQyxFQUFyQjtBQUNEOztBQUVELFNBQVNDLFFBQVQsR0FBb0I7QUFDbEIsT0FBS0osU0FBTCxHQUFpQkQsT0FBakI7QUFDRDs7SUFFb0JNLEk7QUFDbkIsV0FEbUJBLElBQ25CLENBQVlDLEtBQVosRUFBbUI7QUFBQSwwQkFEQUQsSUFDQTs7QUFDakIsU0FBS0YsRUFBTCxHQUFVTCxLQUFLUyxTQUFMLEVBQVY7QUFDQSxTQUFLQyxRQUFMLEdBQWdCLEtBQWhCOztBQUVBLFFBQUksS0FBS0MsWUFBVCxFQUF1QjtBQUNyQixXQUFLLElBQUlDLEdBQVQsSUFBZ0IsS0FBS0QsWUFBckIsRUFBbUM7QUFDakMsWUFBSSxLQUFLQSxZQUFMLENBQWtCRSxjQUFsQixDQUFpQ0QsR0FBakMsQ0FBSixFQUEyQztBQUN6QyxlQUFLQSxHQUFMLElBQVksS0FBS0QsWUFBTCxDQUFrQkMsR0FBbEIsQ0FBWjtBQUNEO0FBQ0Y7QUFDRjs7QUFFRCxTQUFLRSxHQUFMLENBQVNOLEtBQVQ7QUFDRDs7QUFka0JELE0sV0FnQm5CTyxHLGdCQUFJTixLLEVBQU87QUFDVCxTQUFLLElBQUlJLEdBQVQsSUFBZ0JKLEtBQWhCLEVBQXVCO0FBQ3JCLFVBQUlBLE1BQU1LLGNBQU4sQ0FBcUJELEdBQXJCLENBQUosRUFBK0I7QUFDN0IsYUFBS0EsR0FBTCxJQUFZSixNQUFNSSxHQUFOLENBQVo7QUFDRDtBQUNGOztBQUVELFdBQU8sSUFBUDtBQUNELEc7O0FBeEJrQkwsTSxXQTBCbkJRLEssb0JBQVE7QUFDTmYsU0FBS00sUUFBTCxDQUFjLEtBQUtELEVBQW5CLEVBQXVCLElBQXZCOztBQUVBLFNBQUtXLGNBQUwsR0FBc0IsS0FBS2QsU0FBTCxHQUFpQkMsU0FBdkM7QUFDQSxTQUFLYyxVQUFMLEdBQWtCLEtBQWxCOztBQUVBLFFBQUksS0FBS0MsT0FBVCxFQUFrQjtBQUNoQixXQUFLQSxPQUFMLENBQWEsSUFBYjtBQUNEOztBQUVELFdBQU8sSUFBUDtBQUNELEc7O0FBckNrQlgsTSxXQXVDbkJZLEksbUJBQU87QUFDTG5CLFNBQUtJLFVBQUwsQ0FBZ0IsS0FBS0MsRUFBckI7O0FBRUEsUUFBSSxLQUFLZSxNQUFULEVBQWlCO0FBQ2YsV0FBS0EsTUFBTCxDQUFZLElBQVo7QUFDRDs7QUFFRCxXQUFPLElBQVA7QUFDRCxHOztBQS9Da0JiLE0sV0FpRG5CYyxJLG1CQUFPO0FBQ0xyQixTQUFLTSxRQUFMLENBQWMsS0FBS0QsRUFBbkIsRUFBdUIsSUFBdkI7QUFDQSxTQUFLSCxTQUFMLEdBQWlCQyxTQUFqQjtBQUNBLFNBQUthLGNBQUwsR0FBc0JWLFFBQXRCOztBQUVBLFdBQU8sSUFBUDtBQUNELEc7O0FBdkRrQkMsTSxXQXlEbkJlLFEsdUJBQVc7QUFDVCxTQUFLSCxJQUFMOztBQUVBLFFBQUksS0FBS0ksVUFBVCxFQUFxQjtBQUNuQixXQUFLQSxVQUFMLENBQWdCLElBQWhCO0FBQ0Q7QUFDRixHOztBQUVEOzs7Ozs7OztBQWpFbUJoQixNLFdBd0VuQmlCLE8sb0JBQVFoQixLLEVBQU87QUFBQSxRQUNMSCxFQURLLEdBQ3FCLElBRHJCLENBQ0xBLEVBREs7O0FBQUEsUUFDRW9CLGNBREYsNEJBQ3FCLElBRHJCOztBQUViLFdBQU8sSUFBSSxLQUFLQyxXQUFULGNBQTBCRCxjQUExQixFQUE2Q2pCLEtBQTdDLEVBQVA7QUFDRCxHOztTQTNFa0JELEk7OztrQkFBQUEsSSIsImZpbGUiOiJUYXNrLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAgQmFzZSBUYXNrIGNsYXNzIGZvciBjcmVhdGluZyBhIHRhc2sgb24gdGhlIG1haW4gcmVuZGVyIGxvb3AuXG4qL1xuaW1wb3J0ICogYXMgbG9vcCBmcm9tICcuL2xvb3AnO1xuXG5mdW5jdGlvbiBjbGVhbnVwKCkge1xuICB0aGlzLm9uQ2xlYW51cCA9IHVuZGVmaW5lZDtcbiAgbG9vcC5kZWFjdGl2YXRlKHRoaXMuaWQpO1xufVxuXG5mdW5jdGlvbiBhY3RpdmF0ZSgpIHtcbiAgdGhpcy5vbkNsZWFudXAgPSBjbGVhbnVwO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUYXNrIHtcbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICB0aGlzLmlkID0gbG9vcC5nZXRUYXNrSWQoKTtcbiAgICB0aGlzLmlzQWN0aXZlID0gZmFsc2U7XG5cbiAgICBpZiAodGhpcy5kZWZhdWx0UHJvcHMpIHtcbiAgICAgIGZvciAobGV0IGtleSBpbiB0aGlzLmRlZmF1bHRQcm9wcykge1xuICAgICAgICBpZiAodGhpcy5kZWZhdWx0UHJvcHMuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgIHRoaXNba2V5XSA9IHRoaXMuZGVmYXVsdFByb3BzW2tleV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnNldChwcm9wcyk7XG4gIH1cblxuICBzZXQocHJvcHMpIHtcbiAgICBmb3IgKGxldCBrZXkgaW4gcHJvcHMpIHtcbiAgICAgIGlmIChwcm9wcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgIHRoaXNba2V5XSA9IHByb3BzW2tleV07XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBzdGFydCgpIHtcbiAgICBsb29wLmFjdGl2YXRlKHRoaXMuaWQsIHRoaXMpO1xuXG4gICAgdGhpcy5vbkFjdGl2YXRlTG9vcCA9IHRoaXMub25DbGVhbnVwID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuaXNDb21wbGV0ZSA9IGZhbHNlO1xuXG4gICAgaWYgKHRoaXMub25TdGFydCkge1xuICAgICAgdGhpcy5vblN0YXJ0KHRoaXMpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgc3RvcCgpIHtcbiAgICBsb29wLmRlYWN0aXZhdGUodGhpcy5pZCk7XG4gICAgXG4gICAgaWYgKHRoaXMub25TdG9wKSB7XG4gICAgICB0aGlzLm9uU3RvcCh0aGlzKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIG9uY2UoKSB7XG4gICAgbG9vcC5hY3RpdmF0ZSh0aGlzLmlkLCB0aGlzKTtcbiAgICB0aGlzLm9uQ2xlYW51cCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLm9uQWN0aXZhdGVMb29wID0gYWN0aXZhdGU7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGNvbXBsZXRlKCkge1xuICAgIHRoaXMuc3RvcCgpO1xuXG4gICAgaWYgKHRoaXMub25Db21wbGV0ZSkge1xuICAgICAgdGhpcy5vbkNvbXBsZXRlKHRoaXMpO1xuICAgIH1cbiAgfVxuXG4gIC8qXG4gICAgIyBFeHRlbmQgdGhpcyBQcm9jZXNzIHdpdGggbmV3IHByb3BlcnRpZXNcbiAgICAjIyBSZXR1cm5zIG5ldyBpbnN0YW5jZSBvZiB0aGlzIFByb2Nlc3MncyBgcHJvdG90eXBlYCB3aXRoIGV4aXN0aW5nIGFuZCBuZXcgcHJvcGVydGllc1xuXG4gICAgQHBhcmFtIFtvYmplY3RdIChvcHRpb25hbClcbiAgICBAcmV0dXJuIFtQcm9jZXNzXVxuICAqL1xuICBpbmhlcml0KHByb3BzKSB7XG4gICAgY29uc3QgeyBpZCwgLi4uaW5oZXJpdGVkUHJvcHMgfSA9IHRoaXM7XG4gICAgcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHsgLi4uaW5oZXJpdGVkUHJvcHMsIC4uLnByb3BzIH0pO1xuICB9XG59Il19