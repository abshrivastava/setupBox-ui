'use strict';

exports.__esModule = true;

var _Action2 = require('./Action');

var _Action3 = _interopRequireDefault(_Action2);

var _presetEasing = require('./easing/preset-easing');

var _presetEasing2 = _interopRequireDefault(_presetEasing);

var _utils = require('../inc/utils');

var _calc = require('../inc/calc');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var COUNT = 'Count';
var NEXT_STEPS = {
  loop: 'restart',
  yoyo: 'reverse',
  flip: 'flipValues'
};

var Tween = function (_Action) {
  _inherits(Tween, _Action);

  function Tween() {
    _classCallCheck(this, Tween);

    return _possibleConstructorReturn(this, _Action.apply(this, arguments));
  }

  Tween.prototype.start = function start() {
    this.elapsed = 0;
    this.flipCount = this.yoyoCount = this.loopCount = 0;
    this.isScrubbing = false;

    // Set default `from` if none set
    for (var i = 0; i < this.numValueKeys; i++) {
      var key = this.valueKeys[i];
      var value = this.values[key];
      if (value.from === undefined) {
        value.from = 0;
      }
    }

    return _Action.prototype.start.call(this);
  };

  Tween.prototype.onUpdate = function onUpdate(tween, frameStamp, elapsed) {
    var progressTarget = this.playDirection === 1 ? 1 : 0;

    this.ended = true;

    if (!this.isScrubbing) {
      this.elapsed += elapsed * this.dilate * this.playDirection;
    }

    for (var i = 0; i < this.numValueKeys; i++) {
      var key = this.valueKeys[i];
      var value = this.values[key];

      var progress = (0, _calc.restrict)((0, _calc.getProgressFromValue)(this.elapsed - value.delay, 0, value.duration), 0, 1);

      // Mark Tween as NOT ended if still in progress
      if (progress !== progressTarget) {
        this.ended = false;
      }

      // Step progress if we're stepping
      if (value.steps) {
        progress = (0, _calc.stepProgress)(progress, value.steps);
      }

      // Ease progress
      value.current = (0, _calc.ease)(progress, value.from, value.to, value.ease);
    }
  };

  Tween.prototype.onFrameEnd = function onFrameEnd() {
    if (this.ended && !this.isScrubbing) {
      var stepTaken = false;

      for (var key in NEXT_STEPS) {
        if (NEXT_STEPS.hasOwnProperty(key)) {
          if ((0, _utils.isNum)(this[key]) && this[key] > this[key + COUNT]) {
            this[key + COUNT]++;
            stepTaken = true;
            this[NEXT_STEPS[key]]();
          }
        }
      }

      if (!stepTaken) {
        this.complete();
      }
    }
  };

  Tween.prototype.flipValues = function flipValues() {
    var values = this.values;

    this.elapsed = this.duration - this.elapsed;

    for (var key in values) {
      if (values.hasOwnProperty(key)) {
        var value = values[key];
        var _ref = [value.from, value.to];
        value.to = _ref[0];
        value.from = _ref[1];
      }
    }

    return this;
  };

  Tween.prototype.reverse = function reverse() {
    this.playDirection *= -1;
    return this;
  };

  Tween.prototype.restart = function restart() {
    this.elapsed = this.playDirection === 1 ? 0 : this.duration;
    this.started = (0, _utils.currentTime)();
    return this;
  };

  Tween.prototype.seek = function seek(progress) {
    this.seekTime(this.duration * progress);
    return this;
  };

  Tween.prototype.seekTime = function seekTime(elapsed) {
    if (!this.isActive || this.isScrubbing) {
      this.once();
      this.isScrubbing = true;
    }

    this.elapsed = elapsed;

    return this;
  };

  return Tween;
}(_Action3.default);

Tween.prototype.defaultValueProp = 'to';
Tween.prototype.defaultValue = _Action3.default.extendDefaultValue({
  delay: 0,
  duration: 300,
  ease: _presetEasing2.default.easeOut,
  elapsed: 0,
  steps: 0,
  to: 0,
  round: false
});
Tween.prototype.defaultProps = _Action3.default.extendDefaultProps({
  blend: false,
  dilate: 1,
  loop: 0,
  yoyo: 0,
  flip: 0,
  loopCount: 0,
  yoyoCount: 0,
  flipCount: 0,
  playDirection: 1,
  isScrubbing: false,
  ended: false,
  elapsed: 0
});

exports.default = Tween;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9fYWN0aW9ucy9Ud2Vlbi5qcyJdLCJuYW1lcyI6WyJDT1VOVCIsIk5FWFRfU1RFUFMiLCJsb29wIiwieW95byIsImZsaXAiLCJUd2VlbiIsInN0YXJ0IiwiZWxhcHNlZCIsImZsaXBDb3VudCIsInlveW9Db3VudCIsImxvb3BDb3VudCIsImlzU2NydWJiaW5nIiwiaSIsIm51bVZhbHVlS2V5cyIsImtleSIsInZhbHVlS2V5cyIsInZhbHVlIiwidmFsdWVzIiwiZnJvbSIsInVuZGVmaW5lZCIsIm9uVXBkYXRlIiwidHdlZW4iLCJmcmFtZVN0YW1wIiwicHJvZ3Jlc3NUYXJnZXQiLCJwbGF5RGlyZWN0aW9uIiwiZW5kZWQiLCJkaWxhdGUiLCJwcm9ncmVzcyIsImRlbGF5IiwiZHVyYXRpb24iLCJzdGVwcyIsImN1cnJlbnQiLCJ0byIsImVhc2UiLCJvbkZyYW1lRW5kIiwic3RlcFRha2VuIiwiaGFzT3duUHJvcGVydHkiLCJjb21wbGV0ZSIsImZsaXBWYWx1ZXMiLCJyZXZlcnNlIiwicmVzdGFydCIsInN0YXJ0ZWQiLCJzZWVrIiwic2Vla1RpbWUiLCJpc0FjdGl2ZSIsIm9uY2UiLCJwcm90b3R5cGUiLCJkZWZhdWx0VmFsdWVQcm9wIiwiZGVmYXVsdFZhbHVlIiwiZXh0ZW5kRGVmYXVsdFZhbHVlIiwiZWFzZU91dCIsInJvdW5kIiwiZGVmYXVsdFByb3BzIiwiZXh0ZW5kRGVmYXVsdFByb3BzIiwiYmxlbmQiXSwibWFwcGluZ3MiOiI7Ozs7QUFBQTs7OztBQUNBOzs7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7QUFFQSxJQUFNQSxRQUFRLE9BQWQ7QUFDQSxJQUFNQyxhQUFhO0FBQ2pCQyxRQUFNLFNBRFc7QUFFakJDLFFBQU0sU0FGVztBQUdqQkMsUUFBTTtBQUhXLENBQW5COztJQU1NQyxLO1lBQUFBLEs7O1dBQUFBLEs7MEJBQUFBLEs7Ozs7O0FBQUFBLE8sV0FDSkMsSyxvQkFBUTtBQUNOLFNBQUtDLE9BQUwsR0FBZSxDQUFmO0FBQ0EsU0FB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dkRtQixTQUFPO0FBUGdELENBQTFCLENBQS9CO0FBU0E5QyxNQUFNeUMsU0FBTixDQUFnQk0sWUFBaEIsR0FBK0IsaUJBQU9DLGtCQUFQLENBQTBCO0FBQ3ZEQyxTQUFPLEtBRGdEO0FBRXZENUIsVUFBUSxDQUYrQztBQUd2RHhCLFFBQU0sQ0FIaUQ7QUFJdkRDLFFBQU0sQ0FKaUQ7QUFLdkRDLFFBQU0sQ0FMaUQ7QUFNdkRNLGFBQVcsQ0FONEM7QUFPdkRELGFBQVcsQ0FQNEM7QUFRdkRELGFBQVcsQ0FSNEM7QUFTdkRnQixpQkFBZSxDQVR3QztBQVV2RGIsZUFBYSxLQVYwQztBQVd2RGMsU0FBTyxLQVhnRDtBQVl2RGxCLFdBQVM7QUFaOEMsQ0FBMUIsQ0FBL0I7O2tCQWVlRixLIiwiZmlsZSI6IlR3ZWVuLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEFjdGlvbiBmcm9tICcuL0FjdGlvbic7XG5pbXBvcnQgZWFzaW5nIGZyb20gJy4vZWFzaW5nL3ByZXNldC1lYXNpbmcnO1xuaW1wb3J0IHsgY3VycmVudFRpbWUsIGlzTnVtIH0gZnJvbSAnLi4vaW5jL3V0aWxzJztcbmltcG9ydCB7IGVhc2UsIHJlc3RyaWN0LCBnZXRQcm9ncmVzc0Zyb21WYWx1ZSwgc3RlcFByb2dyZXNzIH0gZnJvbSAnLi4vaW5jL2NhbGMnO1xuXG5jb25zdCBDT1VOVCA9ICdDb3VudCc7XG5jb25zdCBORVhUX1NURVBTID0ge1xuICBsb29wOiAncmVzdGFydCcsXG4gIHlveW86ICdyZXZlcnNlJyxcbiAgZmxpcDogJ2ZsaXBWYWx1ZXMnXG59O1xuXG5jbGFzcyBUd2VlbiBleHRlbmRzIEFjdGlvbiB7XG4gIHN0YXJ0KCkge1xuICAgIHRoaXMuZWxhcHNlZCA9IDA7XG4gICAgdGhpcy5mbGlwQ291bnQgPSB0aGlzLnlveW9Db3VudCA9IHRoaXMubG9vcENvdW50ID0gMDtcbiAgICB0aGlzLmlzU2NydWJiaW5nID0gZmFsc2U7XG5cbiAgICAvLyBTZXQgZGVmYXVsdCBgZnJvbWAgaWYgbm9uZSBzZXRcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubnVtVmFsdWVLZXlzOyBpKyspIHtcbiAgICAgIGNvbnN0IGtleSA9IHRoaXMudmFsdWVLZXlzW2ldO1xuICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLnZhbHVlc1trZXldO1xuICAgICAgaWYgKHZhbHVlLmZyb20gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB2YWx1ZS5mcm9tID0gMDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gc3VwZXIuc3RhcnQoKTtcbiAgfVxuXG4gIG9uVXBkYXRlKHR3ZWVuLCBmcmFtZVN0YW1wLCBlbGFwc2VkKSB7XG4gICAgY29uc3QgcHJvZ3Jlc3NUYXJnZXQgPSAodGhpcy5wbGF5RGlyZWN0aW9uID09PSAxKSA/IDEgOiAwO1xuXG4gICAgdGhpcy5lbmRlZCA9IHRydWU7XG5cbiAgICBpZiAoIXRoaXMuaXNTY3J1YmJpbmcpIHtcbiAgICAgIHRoaXMuZWxhcHNlZCArPSAoZWxhcHNlZCAqIHRoaXMuZGlsYXRlKSAqIHRoaXMucGxheURpcmVjdGlvbjtcbiAgICB9XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubnVtVmFsdWVLZXlzOyBpKyspIHtcbiAgICAgIGNvbnN0IGtleSA9IHRoaXMudmFsdWVLZXlzW2ldO1xuICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLnZhbHVlc1trZXldO1xuXG4gICAgICBsZXQgcHJvZ3Jlc3MgPSByZXN0cmljdChnZXRQcm9ncmVzc0Zyb21WYWx1ZSh0aGlzLmVsYXBzZWQgLSB2YWx1ZS5kZWxheSwgMCwgdmFsdWUuZHVyYXRpb24pLCAwLCAxKTtcblxuICAgICAgLy8gTWFyayBUd2VlbiBhcyBOT1QgZW5kZWQgaWYgc3RpbGwgaW4gcHJvZ3Jlc3NcbiAgICAgIGlmIChwcm9ncmVzcyAhPT0gcHJvZ3Jlc3NUYXJnZXQpIHtcbiAgICAgICAgdGhpcy5lbmRlZCA9IGZhbHNlO1xuICAgICAgfVxuXG4gICAgICAvLyBTdGVwIHByb2dyZXNzIGlmIHdlJ3JlIHN0ZXBwaW5nXG4gICAgICBpZiAodmFsdWUuc3RlcHMpIHtcbiAgICAgICAgcHJvZ3Jlc3MgPSBzdGVwUHJvZ3Jlc3MocHJvZ3Jlc3MsIHZhbHVlLnN0ZXBzKTtcbiAgICAgIH1cblxuICAgICAgLy8gRWFzZSBwcm9ncmVzc1xuICAgICAgdmFsdWUuY3VycmVudCA9IGVhc2UocHJvZ3Jlc3MsIHZhbHVlLmZyb20sIHZhbHVlLnRvLCB2YWx1ZS5lYXNlKTtcbiAgICB9XG4gIH1cblxuICBvbkZyYW1lRW5kKCkge1xuICAgIGlmICh0aGlzLmVuZGVkICYmICF0aGlzLmlzU2NydWJiaW5nKSB7XG4gICAgICBsZXQgc3RlcFRha2VuID0gZmFsc2U7XG5cbiAgICAgIGZvciAobGV0IGtleSBpbiBORVhUX1NURVBTKSB7XG4gICAgICAgIGlmIChORVhUX1NURVBTLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgICBpZiAoaXNOdW0odGhpc1trZXldKSAmJiB0aGlzW2tleV0gPiB0aGlzW2tleSArIENPVU5UXSkge1xuICAgICAgICAgICAgdGhpc1trZXkgKyBDT1VOVF0rKztcbiAgICAgICAgICAgIHN0ZXBUYWtlbiA9IHRydWU7XG4gICAgICAgICAgICB0aGlzW05FWFRfU1RFUFNba2V5XV0oKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKCFzdGVwVGFrZW4pIHtcbiAgICAgICAgdGhpcy5jb21wbGV0ZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZsaXBWYWx1ZXMoKSB7XG4gICAgY29uc3QgdmFsdWVzID0gdGhpcy52YWx1ZXM7XG5cbiAgICB0aGlzLmVsYXBzZWQgPSB0aGlzLmR1cmF0aW9uIC0gdGhpcy5lbGFwc2VkO1xuXG4gICAgZm9yIChsZXQga2V5IGluIHZhbHVlcykge1xuICAgICAgaWYgKHZhbHVlcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gdmFsdWVzW2tleV07XG4gICAgICAgIFt2YWx1ZS50bywgdmFsdWUuZnJvbV0gPSBbdmFsdWUuZnJvbSwgdmFsdWUudG9dO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgcmV2ZXJzZSgpIHtcbiAgICB0aGlzLnBsYXlEaXJlY3Rpb24gKj0gLTE7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICByZXN0YXJ0KCkge1xuICAgIHRoaXMuZWxhcHNlZCA9ICh0aGlzLnBsYXlEaXJlY3Rpb24gPT09IDEpID8gMCA6IHRoaXMuZHVyYXRpb247XG4gICAgdGhpcy5zdGFydGVkID0gY3VycmVudFRpbWUoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHNlZWsocHJvZ3Jlc3MpIHtcbiAgICB0aGlzLnNlZWtUaW1lKHRoaXMuZHVyYXRpb24gKiBwcm9ncmVzcyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBzZWVrVGltZShlbGFwc2VkKSB7XG4gICAgaWYgKCF0aGlzLmlzQWN0aXZlIHx8IHRoaXMuaXNTY3J1YmJpbmcpIHtcbiAgICAgIHRoaXMub25jZSgpO1xuICAgICAgdGhpcy5pc1NjcnViYmluZyA9IHRydWU7XG4gICAgfVxuXG4gICAgdGhpcy5lbGFwc2VkID0gZWxhcHNlZDtcblxuICAgIHJldHVybiB0aGlzO1xuICB9XG59XG5cblR3ZWVuLnByb3RvdHlwZS5kZWZhdWx0VmFsdWVQcm9wID0gJ3RvJztcblR3ZWVuLnByb3RvdHlwZS5kZWZhdWx0VmFsdWUgPSBBY3Rpb24uZXh0ZW5kRGVmYXVsdFZhbHVlKHtcbiAgZGVsYXk6IDAsXG4gIGR1cmF0aW9uOiAzMDAsXG4gIGVhc2U6IGVhc2luZy5lYXNlT3V0LFxuICBlbGFwc2VkOiAwLFxuICBzdGVwczogMCxcbiAgdG86IDAsXG4gIHJvdW5kOiBmYWxzZVxufSk7XG5Ud2Vlbi5wcm90b3R5cGUuZGVmYXVsdFByb3BzID0gQWN0aW9uLmV4dGVuZERlZmF1bHRQcm9wcyh7XG4gIGJsZW5kOiBmYWxzZSxcbiAgZGlsYXRlOiAxLFxuICBsb29wOiAwLFxuICB5b3lvOiAwLFxuICBmbGlwOiAwLFxuICBsb29wQ291bnQ6IDAsXG4gIHlveW9Db3VudDogMCxcbiAgZmxpcENvdW50OiAwLFxuICBwbGF5RGlyZWN0aW9uOiAxLFxuICBpc1NjcnViYmluZzogZmFsc2UsXG4gIGVuZGVkOiBmYWxzZSxcbiAgZWxhcHNlZDogMFxufSk7XG5cbmV4cG9ydCBkZWZhdWx0IFR3ZWVuO1xuIl19