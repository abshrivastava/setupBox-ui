'use strict';

exports.__esModule = true;

var _ = require('./');

var _2 = _interopRequireDefault(_);

var _framesync = require('../framesync');

var _calc = require('../inc/calc');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var Velocity = function (_Action) {
  _inherits(Velocity, _Action);

  function Velocity() {
    _classCallCheck(this, Velocity);

    return _possibleConstructorReturn(this, _Action.apply(this, arguments));
  }

  Velocity.prototype.onUpdate = function onUpdate() {
    var _props = this.props;
    var acceleration = _props.acceleration;
    var autoStopSpeed = _props.autoStopSpeed;
    var friction = _props.friction;
    var velocity = _props.velocity;

    var newVelocity = velocity;
    var elapsed = (0, _framesync.timeSinceLastFrame)();

    // Apply acceleration to velocity
    if (acceleration) {
      newVelocity += (0, _calc.speedPerFrame)(acceleration, elapsed);
    }

    // Apply friction to velocity
    if (friction) {
      newVelocity *= Math.pow(1 - friction, elapsed / 100);
    }

    // Apply velocity
    this.current += (0, _calc.speedPerFrame)(newVelocity, elapsed);
    this.props.velocity = newVelocity;

    if (!newVelocity || Math.abs(newVelocity) <= autoStopSpeed) {
      this.complete();
    }
  };

  return Velocity;
}(_2.default);

Velocity.defaultProps = {
  acceleration: 0,
  friction: 0,
  velocity: 0,
  autoStopSpeed: 0.001
};

exports.default = function (props) {
  return new Velocity(props);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hY3Rpb25zL3ZlbG9jaXR5LmpzIl0sIm5hbWVzIjpbIlZlbG9jaXR5Iiwib25VcGRhdGUiLCJwcm9wcyIsImFjY2VsZXJhdGlvbiIsImF1dG9TdG9wU3BlZWQiLCJmcmljdGlvbiIsInZlbG9jaXR5IiwibmV3VmVsb2NpdHkiLCJlbGFwc2VkIiwiY3VycmVudCIsIk1hdGgiLCJhYnMiLCJjb21wbGV0ZSIsImRlZmF1bHRQcm9wcyJdLCJtYXBwaW5ncyI6Ijs7OztBQUFBOzs7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7SUFFTUEsUTtZQUFBQSxROztXQUFBQSxROzBCQUFBQSxROzs7OztBQUFBQSxVLFdBUUpDLFEsdUJBQVc7QUFBQSxpQkFDbUQsS0FBS0MsS0FEeEQ7QUFBQSxRQUNEQyxZQURDLFVBQ0RBLFlBREM7QUFBQSxRQUNhQyxhQURiLFVBQ2FBLGFBRGI7QUFBQSxRQUM0QkMsUUFENUIsVUFDNEJBLFFBRDVCO0FBQUEsUUFDc0NDLFFBRHRDLFVBQ3NDQSxRQUR0Qzs7QUFFVCxRQUFJQyxjQUFjRCxRQUFsQjtBQUNBLFFBQU1FLFVBQVUsb0NBQWhCOztBQUVBO0FBQ0EsUUFBSUwsWUFBSixFQUFrQjtBQUNoQkkscUJBQWUseUJBQWNKLFlBQWQsRUFBNEJLLE9BQTVCLENBQWY7QUFDRDs7QUFFRDtBQUNBLFFBQUlILFFBQUosRUFBYztBQUNaRSw4QkFBZ0IsSUFBSUYsUUFBcEIsRUFBa0NHLFVBQVUsR0FBNUM7QUFDRDs7QUFFRDtBQUNBLFNBQUtDLE9BQUwsSUFBZ0IseUJBQWNGLFdBQWQsRUFBMkJDLE9BQTNCLENBQWhCO0FBQ0EsU0FBS04sS0FBTCxDQUFXSSxRQUFYLEdBQXNCQyxXQUF0Qjs7QUFFQSxRQUFJLENBQUNBLFdBQUQsSUFBZ0JHLEtBQUtDLEdBQUwsQ0FBU0osV0FBVCxLQUF5QkgsYUFBN0MsRUFBNEQ7QUFDMUQsV0FBS1EsUUFBTDtBQUNEO0FBQ0YsRzs7U0E5QkdaLFE7OztBQUFBQSxRLENBQ0dhLFksR0FBZTtBQUNwQlYsZ0JBQWMsQ0FETTtBQUVwQkUsWUFBVSxDQUZVO0FBR3BCQyxZQUFVLENBSFU7QUFJcEJGLGlCQUFlO0FBSkssQzs7a0JBZ0NULFVBQUNGLEtBQUQ7QUFBQSxTQUFXLElBQUlGLFFBQUosQ0FBYUUsS0FBYixDQUFYO0FBQUEsQyIsImZpbGUiOiJ2ZWxvY2l0eS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBBY3Rpb24gZnJvbSAnLi8nO1xuaW1wb3J0IHsgdGltZVNpbmNlTGFzdEZyYW1lIH0gZnJvbSAnLi4vZnJhbWVzeW5jJztcbmltcG9ydCB7IHNwZWVkUGVyRnJhbWUgfSBmcm9tICcuLi9pbmMvY2FsYyc7XG5cbmNsYXNzIFZlbG9jaXR5IGV4dGVuZHMgQWN0aW9uIHtcbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBhY2NlbGVyYXRpb246IDAsXG4gICAgZnJpY3Rpb246IDAsXG4gICAgdmVsb2NpdHk6IDAsXG4gICAgYXV0b1N0b3BTcGVlZDogMC4wMDFcbiAgfVxuXG4gIG9uVXBkYXRlKCkge1xuICAgIGNvbnN0IHsgYWNjZWxlcmF0aW9uLCBhdXRvU3RvcFNwZWVkLCBmcmljdGlvbiwgdmVsb2NpdHkgfSA9IHRoaXMucHJvcHM7XG4gICAgbGV0IG5ld1ZlbG9jaXR5ID0gdmVsb2NpdHk7XG4gICAgY29uc3QgZWxhcHNlZCA9IHRpbWVTaW5jZUxhc3RGcmFtZSgpO1xuXG4gICAgLy8gQXBwbHkgYWNjZWxlcmF0aW9uIHRvIHZlbG9jaXR5XG4gICAgaWYgKGFjY2VsZXJhdGlvbikge1xuICAgICAgbmV3VmVsb2NpdHkgKz0gc3BlZWRQZXJGcmFtZShhY2NlbGVyYXRpb24sIGVsYXBzZWQpO1xuICAgIH1cblxuICAgIC8vIEFwcGx5IGZyaWN0aW9uIHRvIHZlbG9jaXR5XG4gICAgaWYgKGZyaWN0aW9uKSB7XG4gICAgICBuZXdWZWxvY2l0eSAqPSAoMSAtIGZyaWN0aW9uKSAqKiAoZWxhcHNlZCAvIDEwMCk7XG4gICAgfVxuXG4gICAgLy8gQXBwbHkgdmVsb2NpdHlcbiAgICB0aGlzLmN1cnJlbnQgKz0gc3BlZWRQZXJGcmFtZShuZXdWZWxvY2l0eSwgZWxhcHNlZCk7XG4gICAgdGhpcy5wcm9wcy52ZWxvY2l0eSA9IG5ld1ZlbG9jaXR5O1xuXG4gICAgaWYgKCFuZXdWZWxvY2l0eSB8fCBNYXRoLmFicyhuZXdWZWxvY2l0eSkgPD0gYXV0b1N0b3BTcGVlZCkge1xuICAgICAgdGhpcy5jb21wbGV0ZSgpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCAocHJvcHMpID0+IG5ldyBWZWxvY2l0eShwcm9wcyk7Il19