'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _framesync = require('../framesync');

var _calc = require('../inc/calc');

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Action = function () {
  function Action(props) {
    _classCallCheck(this, Action);

    this.update = this.update.bind(this);

    this.props = _extends({}, this.constructor.defaultProps);

    this.setProps(props);

    this.current = props.current || 0;
  }

  Action.prototype.start = function start() {
    var _props = this.props;
    var onStart = _props.onStart;
    var _onStart = _props._onStart;
    var passive = _props.passive;


    if (!passive) {
      this.isActive = true;
      (0, _framesync.onFrameUpdate)(this.update);
    }

    if (this.onStart) this.onStart();
    if (onStart) onStart(this);
    if (_onStart) _onStart(this);

    return this;
  };

  Action.prototype.stop = function stop() {
    var _props2 = this.props;
    var onStop = _props2.onStop;
    var _onStop = _props2._onStop;
    var passive = _props2.passive;


    if (!passive) {
      this.isActive = false;
      (0, _framesync.cancelOnFrameUpdate)(this.update);
    }

    if (this.onStop) this.onStop();
    if (onStop) onStop(this);
    if (_onStop) _onStop(this);

    return this;
  };

  Action.prototype.complete = function complete() {
    var _props3 = this.props;
    var onComplete = _props3.onComplete;
    var _onComplete = _props3._onComplete;


    if (this.onComplete) this.onComplete();
    if (onComplete) onComplete(this);
    if (_onComplete) _onComplete(this);

    this.stop();

    return this;
  };

  Action.prototype.update = function update() {
    this.lastUpdated = (0, _framesync.timeSinceLastFrame)();
    this.prev = this.current;

    var _props4 = this.props;
    var onUpdate = _props4.onUpdate;
    var _onUpdate = _props4._onUpdate;
    var passive = _props4.passive;


    if (this.onUpdate) {
      this.current = this.onUpdate();
    }

    var filtered = this.get();
    if (onUpdate) onUpdate(filtered, this);
    if (_onUpdate) _onUpdate(filtered, this);

    if (!passive && this.isActive) {
      (0, _framesync.onFrameUpdate)(this.update);
    }

    if (this.isActionComplete && this.isActionComplete()) {
      this.complete();
    }

    return this;
  };

  Action.prototype.setProps = function setProps(props) {
    this.props = _extends({}, this.props, props);
  };

  Action.prototype.get = function get() {
    var filter = this.props.filter;

    return filter ? filter(this.current) : this.current;
  };

  Action.prototype.getVelocity = function getVelocity() {
    return (0, _calc.speedPerSecond)(this.prev - this.current, this.lastUpdated);
  };

  return Action;
}();

exports.default = Action;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hY3Rpb25zL2luZGV4LmpzIl0sIm5hbWVzIjpbIkFjdGlvbiIsInByb3BzIiwidXBkYXRlIiwiYmluZCIsImNvbnN0cnVjdG9yIiwiZGVmYXVsdFByb3BzIiwic2V0UHJvcHMiLCJjdXJyZW50Iiwic3RhcnQiLCJvblN0YXJ0IiwiX29uU3RhcnQiLCJwYXNzaXZlIiwiaXNBY3RpdmUiLCJzdG9wIiwib25TdG9wIiwiX29uU3RvcCIsImNvbXBsZXRlIiwib25Db21wbGV0ZSIsIl9vbkNvbXBsZXRlIiwibGFzdFVwZGF0ZWQiLCJwcmV2Iiwib25VcGRhdGUiLCJfb25VcGRhdGUiLCJmaWx0ZXJlZCIsImdldCIsImlzQWN0aW9uQ29tcGxldGUiLCJmaWx0ZXIiLCJnZXRWZWxvY2l0eSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7O0FBQ0E7Ozs7SUFFTUEsTTtBQUNKLFdBRElBLE1BQ0osQ0FBWUMsS0FBWixFQUFtQjtBQUFBLDBCQURmRCxNQUNlOztBQUNqQixTQUFLRSxNQUFMLEdBQWMsS0FBS0EsTUFBTCxDQUFZQyxJQUFaLENBQWlCLElBQWpCLENBQWQ7O0FBRUEsU0FBS0YsS0FBTCxnQkFDSyxLQUFLRyxXQUFMLENBQWlCQyxZQUR0Qjs7QUFJQSxTQUFLQyxRQUFMLENBQWNMLEtBQWQ7O0FBRUEsU0FBS00sT0FBTCxHQUFlTixNQUFNTSxPQUFOLElBQWlCLENBQWhDO0FBQ0Q7O0FBWEdQLFEsV0FhSlEsSyxvQkFBUTtBQUFBLGlCQUNpQyxLQUFLUCxLQUR0QztBQUFBLFFBQ0VRLE9BREYsVUFDRUEsT0FERjtBQUFBLFFBQ1dDLFFBRFgsVUFDV0EsUUFEWDtBQUFBLFFBQ3FCQyxPQURyQixVQUNxQkEsT0FEckI7OztBQUdOLFFBQUksQ0FBQ0EsT0FBTCxFQUFjO0FBQ1osV0FBS0MsUUFBTCxHQUFnQixJQUFoQjtBQUNBLG9DQUFjLEtBQUtWLE1BQW5CO0FBQ0Q7O0FBRUQsUUFBSSxLQUFLTyxPQUFULEVBQWtCLEtBQUtBLE9BQUw7QUFDbEIsUUFBSUEsT0FBSixFQUFhQSxRQUFRLElBQVI7QUFDYixRQUFJQyxRQUFKLEVBQWNBLFNBQVMsSUFBVDs7QUFFZCxXQUFPLElBQVA7QUFDRCxHOztBQTFCR1YsUSxXQTRCSmEsSSxtQkFBTztBQUFBLGtCQUNnQyxLQUFLWixLQURyQztBQUFBLFFBQ0dhLE1BREgsV0FDR0EsTUFESDtBQUFBLFFBQ1dDLE9BRFgsV0FDV0EsT0FEWDtBQUFBLFFBQ29CSixPQURwQixXQUNvQkEsT0FEcEI7OztBQUdMLFFBQUksQ0FBQ0EsT0FBTCxFQUFjO0FBQ1osV0FBS0MsUUFBTCxHQUFnQixLQUFoQjtBQUNBLDBDQUFvQixLQUFLVixNQUF6QjtBQUNEOztBQUVELFFBQUksS0FBS1ksTUFBVCxFQUFpQixLQUFLQSxNQUFMO0FBQ2pCLFFBQUlBLE1BQUosRUFBWUEsT0FBTyxJQUFQO0FBQ1osUUFBSUMsT0FBSixFQUFhQSxRQUFRLElBQVI7O0FBRWIsV0FBTyxJQUFQO0FBQ0QsRzs7QUF6Q0dmLFEsV0EyQ0pnQixRLHVCQUFXO0FBQUEsa0JBQzJCLEtBQUtmLEtBRGhDO0FBQUEsUUFDRGdCLFVBREMsV0FDREEsVUFEQztBQUFBLFFBQ1dDLFdBRFgsV0FDV0EsV0FEWDs7O0FBR1QsUUFBSSxLQUFLRCxVQUFULEVBQXFCLEtBQUtBLFVBQUw7QUFDckIsUUFBSUEsVUFBSixFQUFnQkEsV0FBVyxJQUFYO0FBQ2hCLFFBQUlDLFdBQUosRUFBaUJBLFlBQVksSUFBWjs7QUFFakIsU0FBS0wsSUFBTDs7QUFFQSxXQUFPLElBQVA7QUFDRCxHOztBQXJER2IsUSxXQXVESkUsTSxxQkFBUztBQUNQLFNBQUtpQixXQUFMLEdBQW1CLG9DQUFuQjtBQUNBLFNBQUtDLElBQUwsR0FBWSxLQUFLYixPQUFqQjs7QUFGTyxrQkFJa0MsS0FBS04sS0FKdkM7QUFBQSxRQUlDb0IsUUFKRCxXQUlDQSxRQUpEO0FBQUEsUUFJV0MsU0FKWCxXQUlXQSxTQUpYO0FBQUEsUUFJc0JYLE9BSnRCLFdBSXNCQSxPQUp0Qjs7O0FBTVAsUUFBSSxLQUFLVSxRQUFULEVBQW1CO0FBQ2pCLFdBQUtkLE9BQUwsR0FBZSxLQUFLYyxRQUFMLEVBQWY7QUFDRDs7QUFFRCxRQUFNRSxXQUFXLEtBQUtDLEdBQUwsRUFBakI7QUFDQSxRQUFJSCxRQUFKLEVBQWNBLFNBQVNFLFFBQVQsRUFBbUIsSUFBbkI7QUFDZCxRQUFJRCxTQUFKLEVBQWVBLFVBQVVDLFFBQVYsRUFBb0IsSUFBcEI7O0FBRWYsUUFBSSxDQUFDWixPQUFELElBQVksS0FBS0MsUUFBckIsRUFBK0I7QUFDN0Isb0NBQWMsS0FBS1YsTUFBbkI7QUFDRDs7QUFFRCxRQUFJLEtBQUt1QixnQkFBTCxJQUF5QixLQUFLQSxnQkFBTCxFQUE3QixFQUFzRDtBQUNwRCxXQUFLVCxRQUFMO0FBQ0Q7O0FBRUQsV0FBTyxJQUFQO0FBQ0QsRzs7QUE5RUdoQixRLFdBZ0ZKTSxRLHFCQUFTTCxLLEVBQU87QUFDZCxTQUFLQSxLQUFMLGdCQUNLLEtBQUtBLEtBRFYsRUFFS0EsS0FGTDtBQUlELEc7O0FBckZHRCxRLFdBdUZKd0IsRyxrQkFBTTtBQUFBLFFBQ0lFLE1BREosR0FDZSxLQUFLekIsS0FEcEIsQ0FDSXlCLE1BREo7O0FBRUosV0FBT0EsU0FBU0EsT0FBTyxLQUFLbkIsT0FBWixDQUFULEdBQWdDLEtBQUtBLE9BQTVDO0FBQ0QsRzs7QUExRkdQLFEsV0E0RkoyQixXLDBCQUFjO0FBQ1osV0FBTywwQkFBZSxLQUFLUCxJQUFMLEdBQVksS0FBS2IsT0FBaEMsRUFBeUMsS0FBS1ksV0FBOUMsQ0FBUDtBQUNELEc7O1NBOUZHbkIsTTs7O2tCQWlHU0EsTSIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IG9uRnJhbWVVcGRhdGUsIGNhbmNlbE9uRnJhbWVVcGRhdGUsIHRpbWVTaW5jZUxhc3RGcmFtZSB9IGZyb20gJy4uL2ZyYW1lc3luYyc7XG5pbXBvcnQgeyBzcGVlZFBlclNlY29uZCB9IGZyb20gJy4uL2luYy9jYWxjJztcblxuY2xhc3MgQWN0aW9uIHtcbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICB0aGlzLnVwZGF0ZSA9IHRoaXMudXBkYXRlLmJpbmQodGhpcyk7XG5cbiAgICB0aGlzLnByb3BzID0ge1xuICAgICAgLi4udGhpcy5jb25zdHJ1Y3Rvci5kZWZhdWx0UHJvcHNcbiAgICB9O1xuXG4gICAgdGhpcy5zZXRQcm9wcyhwcm9wcyk7XG5cbiAgICB0aGlzLmN1cnJlbnQgPSBwcm9wcy5jdXJyZW50IHx8IDA7XG4gIH1cblxuICBzdGFydCgpIHtcbiAgICBjb25zdCB7IG9uU3RhcnQsIF9vblN0YXJ0LCBwYXNzaXZlIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgaWYgKCFwYXNzaXZlKSB7XG4gICAgICB0aGlzLmlzQWN0aXZlID0gdHJ1ZTtcbiAgICAgIG9uRnJhbWVVcGRhdGUodGhpcy51cGRhdGUpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLm9uU3RhcnQpIHRoaXMub25TdGFydCgpO1xuICAgIGlmIChvblN0YXJ0KSBvblN0YXJ0KHRoaXMpO1xuICAgIGlmIChfb25TdGFydCkgX29uU3RhcnQodGhpcyk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHN0b3AoKSB7XG4gICAgY29uc3QgeyBvblN0b3AsIF9vblN0b3AsIHBhc3NpdmUgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBpZiAoIXBhc3NpdmUpIHtcbiAgICAgIHRoaXMuaXNBY3RpdmUgPSBmYWxzZTtcbiAgICAgIGNhbmNlbE9uRnJhbWVVcGRhdGUodGhpcy51cGRhdGUpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLm9uU3RvcCkgdGhpcy5vblN0b3AoKTtcbiAgICBpZiAob25TdG9wKSBvblN0b3AodGhpcyk7XG4gICAgaWYgKF9vblN0b3ApIF9vblN0b3AodGhpcyk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGNvbXBsZXRlKCkge1xuICAgIGNvbnN0IHsgb25Db21wbGV0ZSwgX29uQ29tcGxldGUgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBpZiAodGhpcy5vbkNvbXBsZXRlKSB0aGlzLm9uQ29tcGxldGUoKTtcbiAgICBpZiAob25Db21wbGV0ZSkgb25Db21wbGV0ZSh0aGlzKTtcbiAgICBpZiAoX29uQ29tcGxldGUpIF9vbkNvbXBsZXRlKHRoaXMpO1xuXG4gICAgdGhpcy5zdG9wKCk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHVwZGF0ZSgpIHtcbiAgICB0aGlzLmxhc3RVcGRhdGVkID0gdGltZVNpbmNlTGFzdEZyYW1lKCk7XG4gICAgdGhpcy5wcmV2ID0gdGhpcy5jdXJyZW50O1xuXG4gICAgY29uc3QgeyBvblVwZGF0ZSwgX29uVXBkYXRlLCBwYXNzaXZlIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgaWYgKHRoaXMub25VcGRhdGUpIHtcbiAgICAgIHRoaXMuY3VycmVudCA9IHRoaXMub25VcGRhdGUoKTtcbiAgICB9XG5cbiAgICBjb25zdCBmaWx0ZXJlZCA9IHRoaXMuZ2V0KCk7XG4gICAgaWYgKG9uVXBkYXRlKSBvblVwZGF0ZShmaWx0ZXJlZCwgdGhpcyk7XG4gICAgaWYgKF9vblVwZGF0ZSkgX29uVXBkYXRlKGZpbHRlcmVkLCB0aGlzKTtcblxuICAgIGlmICghcGFzc2l2ZSAmJiB0aGlzLmlzQWN0aXZlKSB7XG4gICAgICBvbkZyYW1lVXBkYXRlKHRoaXMudXBkYXRlKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5pc0FjdGlvbkNvbXBsZXRlICYmIHRoaXMuaXNBY3Rpb25Db21wbGV0ZSgpKSB7XG4gICAgICB0aGlzLmNvbXBsZXRlKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBzZXRQcm9wcyhwcm9wcykge1xuICAgIHRoaXMucHJvcHMgPSB7XG4gICAgICAuLi50aGlzLnByb3BzLFxuICAgICAgLi4ucHJvcHNcbiAgICB9O1xuICB9XG5cbiAgZ2V0KCkge1xuICAgIGNvbnN0IHsgZmlsdGVyIH0gPSB0aGlzLnByb3BzO1xuICAgIHJldHVybiBmaWx0ZXIgPyBmaWx0ZXIodGhpcy5jdXJyZW50KSA6IHRoaXMuY3VycmVudDtcbiAgfVxuXG4gIGdldFZlbG9jaXR5KCkge1xuICAgIHJldHVybiBzcGVlZFBlclNlY29uZCh0aGlzLnByZXYgLSB0aGlzLmN1cnJlbnQsIHRoaXMubGFzdFVwZGF0ZWQpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEFjdGlvbjtcbiJdfQ==